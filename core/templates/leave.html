<!DOCTYPE html>
<html>
<head>
<title>Leave Management</title>
{% load static %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body { background:#f1f5f9; font-family:'Segoe UI',sans-serif; }

.sidebar {
    height: 100vh;
    width: 220px;
    position: fixed;
    top: 0;
    left: 0;
    background: linear-gradient(145deg, #4e73df, #1cc88a);
    padding-top: 30px;
}

.sidebar h3 {
    color:#fff;
    text-align:center;
    margin-bottom:30px;
    font-weight:bold;
}

.sidebar a {
    padding:12px 20px;
    color:#fff;
    text-decoration:none;
    display:flex;
    align-items:center;
    border-radius:8px;
    margin:5px 10px;
    transition:.3s;
}

.sidebar a:hover,
.sidebar a.active {
    background:rgba(255,255,255,.25);
    transform:translateX(5px);
}

.content {
    margin-left:240px;
    padding:25px;
}

.section-card {
    border-radius:18px;
    box-shadow:0 10px 25px rgba(0,0,0,.15);
    transition:.3s;
}

.section-card:hover {
    transform:translateY(-4px);
}

.section-title {
    font-weight:bold;
    margin-bottom:15px;
}

.table thead {
    background:linear-gradient(90deg,#0dcaf0,#4e73df);
    color:#fff;
}
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h3>Smart ERP</h3>
    <a href="/dashboard/"><i class="fas fa-home me-2"></i>Dashboard</a>
    <a href="/company/"><i class="fas fa-building me-2"></i>Company</a>
    <a href="/inventory/"><i class="fas fa-boxes me-2"></i>Inventory</a>
    <a href="/employee/"><i class="fas fa-user-tie me-2"></i>Employees</a>
    <a href="/sales/"><i class="fas fa-dollar-sign me-2"></i>Sales</a>
    <a href="{% url 'leave' %}" class="active"><i class="fas fa-calendar-check me-2"></i>Leave</a>
    <a href="/logout/"><i class="fas fa-sign-out-alt me-2"></i>Logout</a>
</div>

<div class="content">

<h2 class="mb-4"><i class="fas fa-calendar-check me-2 text-primary"></i>Leave Management</h2>

<!-- ACTIVE EMPLOYEES -->
<div class="card section-card p-4 mb-4">
    <h5 class="section-title text-success">
        <i class="fas fa-user-check me-2"></i>Active Employees
    </h5>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Role</th>
            </tr>
        </thead>
        <tbody>
            {% for e in active_employees_list %}
            <tr>
                <td>{{ e.user.username }}</td>
                <td>{{ e.phone }}</td>
                <td>{{ e.role }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="3" class="text-center text-muted">No active employees</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- ON LEAVE EMPLOYEES -->
<div class="card section-card p-4 mb-4">
    <h5 class="section-title text-warning">
        <i class="fas fa-user-times me-2"></i>Employees On Leave
    </h5>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Phone</th>
                <th>Role</th>
                <th>Reason</th>
            </tr>
        </thead>
        <tbody>
            {% for l in on_leave_employees_list %}
            <tr>
                <td>{{ l.employee.user.username }}</td>
                <td>{{ l.employee.phone }}</td>
                <td>{{ l.employee.role }}</td>
                <td>{{ l.reason }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="text-center text-muted">No employees on leave</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- EXISTING CONTENT SHIFTED BELOW -->

<!-- Leave Stats -->
<div class="row text-center mb-4">
    <div class="col-md-4">
        <div class="card p-3 shadow">
            <h6>Total Requests</h6>
            <h3>{{ total_leave }}</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 shadow bg-success text-white">
            <h6>Approved</h6>
            <h3>{{ approved_leave }}</h3>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card p-3 shadow bg-warning text-white">
            <h6>Pending</h6>
            <h3>{{ pending_leave }}</h3>
        </div>
    </div>
</div>

<div class="row">

<!-- APPLY LEAVE -->
<div class="col-md-4">
<div class="card p-3 shadow mb-4">
<h5><i class="fas fa-paper-plane me-2"></i>Apply Leave</h5>

{% for message in messages %}
<div class="alert alert-success">{{ message }}</div>
{% endfor %}

<form method="post">
{% csrf_token %}
<label>Start Date</label>
<input type="date" name="start_date" class="form-control mb-2" required>

<label>End Date</label>
<input type="date" name="end_date" class="form-control mb-2" required>

<label>Reason</label>
<textarea name="reason" class="form-control mb-3" required></textarea>

<button class="btn btn-primary w-100">Submit</button>
</form>
</div>
</div>

<!-- LEAVE HISTORY -->
<div class="col-md-8">
<div class="card shadow">
<div class="card-header bg-info text-white">Leave History</div>

<table class="table table-hover mb-0">
<tr>
<th>Dates</th>
<th>Reason</th>
<th>Status</th>
</tr>

{% for l in leaves %}
<tr>
<td>{{ l.start_date }} â†’ {{ l.end_date }}</td>
<td>{{ l.reason }}</td>
<td>
{% if l.status == 'Approved' %}
<span class="badge bg-success">Approved</span>
{% elif l.status == 'Rejected' %}
<span class="badge bg-danger">Rejected</span>
{% else %}
<span class="badge bg-warning">Pending</span>
{% endif %}
</td>
</tr>
{% empty %}
<tr><td colspan="3" class="text-center">No leave records</td></tr>
{% endfor %}
</table>
</div>
</div>

</div>

</div>
</body>
</html>
